#!/bin/sh

trap quit SIGINT

function cleanup() {
  kill -INT $SER
  kill -INT $PAR
  stty isig ixon icrnl brkint imaxbel ignpar opost
  rm -f s/startup-sequence
}

function quit() {
  kill $FSUAE
  cleanup
}

cat >s/startup-sequence <<EOF
echo $@
$@
ExitUAE
EOF

# With such settings I can interact with ROMWACK :-)
socat PTY,link=/tmp/vser,raw,echo=0 STDOUT,raw,echo=0 &
SER=$!
socat -u PTY,link=/tmp/vpar,raw,echo=0 STDERR,raw,echo=0 &
PAR=$!
fs-uae >/dev/null &
FSUAE=$!
wait $FSUAE
cleanup
